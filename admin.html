<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Admin - Ja√∫ Emprega</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- ESTILOS GERAIS --- */
      body {
        font-family: "Poppins", sans-serif;
        background: #1a1a1a;
        color: #eee;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }

      .container {
        max-width: 900px;
        width: 100%;
      }

      /* --- TELA DE LOGIN --- */
      #tela-login {
        background: #2d2d2d;
        padding: 40px;
        border-radius: 15px;
        text-align: center;
        max-width: 400px;
        margin: 10vh auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }
      input[type="password"] {
        width: 100%;
        padding: 15px;
        margin: 15px 0;
        border: none;
        border-radius: 8px;
        background: #444;
        color: white;
        outline: none;
        box-sizing: border-box;
      }
      .btn-entrar {
        width: 100%;
        padding: 15px;
        background: #004aad;
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
      }
      .btn-entrar:hover {
        background: #003885;
        transform: scale(1.02);
      }

      /* --- PAINEL PRINCIPAL --- */
      #painel-admin {
        display: none;
        width: 100%;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        border-bottom: 1px solid #444;
        padding-bottom: 20px;
      }
      h1 {
        margin: 0;
        font-size: 1.8rem;
      }
      .btn-sair {
        background: #444;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
      }

      /* --- √ÅREA DE BANNERS --- */
      .banner-section {
        background: #252525;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 40px;
        border: 1px solid #333;
      }
      .banner-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .upload-card {
        background: #2d2d2d;
        border: 2px dashed #555;
        border-radius: 12px;
        aspect-ratio: 1 / 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: 0.3s;
        position: relative;
        overflow: hidden;
      }
      .upload-card:hover {
        border-color: #004aad;
        background: #333;
      }

      .input-file-hidden {
        display: none;
      }

      .icon-camera {
        font-size: 2rem;
        color: #666;
        margin-bottom: 10px;
      }
      .text-label {
        color: #888;
        font-size: 0.9rem;
      }

      .preview-img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: none;
      }

      /* --- LISTA DE VAGAS --- */
      .vaga-pendente {
        background: #2d2d2d;
        padding: 20px;
        margin-bottom: 15px;
        border-radius: 10px;
        border-left: 5px solid #ffc107;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }
      .vaga-info h3 {
        margin: 0 0 5px 0;
      }
      .vaga-info p {
        margin: 0;
        color: #aaa;
        font-size: 0.9rem;
      }

      .btn-acao {
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        color: white;
        transition: 0.2s;
      }
      .btn-aprovar {
        background: #28a745;
      }
      .btn-aprovar:hover {
        background: #218838;
      }
      .btn-reprovar {
        background: #dc3545;
      }
      .btn-reprovar:hover {
        background: #c82333;
      }

      #erro-msg {
        color: #ff6b6b;
        display: none;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div id="tela-login">
      <h2>üîí √Årea Restrita</h2>
      <p style="color: #aaa">Painel do Administrador</p>
      <input type="password" id="campo-senha" placeholder="Digite a senha" />
      <button class="btn-entrar" onclick="fazerLogin()">Acessar Painel</button>
      <p id="erro-msg">Senha incorreta!</p>
    </div>

    <div id="painel-admin" class="container">
      <header>
        <h1>Painel de Controle</h1>
        <button class="btn-sair" onclick="sair()">Sair</button>
      </header>

      <div class="banner-section">
        <h2
          style="margin: 0; border-bottom: 1px solid #444; padding-bottom: 10px"
        >
          üì¢ Banners Publicit√°rios (1080x1080)
        </h2>
        <p style="color: #777; font-size: 0.9rem; margin-top: 5px">
          Clique nos quadrados para subir uma imagem nova. Atualiza na hora.
        </p>

        <div class="banner-grid">
          <label class="upload-card">
            <input
              type="file"
              class="input-file-hidden"
              accept="image/*"
              onchange="converterEEnviar(this, 1)"
            />
            <span class="icon-camera">üì∑</span>
            <span class="text-label">Banner 1</span>
            <img id="preview1" class="preview-img" />
          </label>

          <label class="upload-card">
            <input
              type="file"
              class="input-file-hidden"
              accept="image/*"
              onchange="converterEEnviar(this, 2)"
            />
            <span class="icon-camera">üì∑</span>
            <span class="text-label">Banner 2</span>
            <img id="preview2" class="preview-img" />
          </label>

          <label class="upload-card">
            <input
              type="file"
              class="input-file-hidden"
              accept="image/*"
              onchange="converterEEnviar(this, 3)"
            />
            <span class="icon-camera">üì∑</span>
            <span class="text-label">Banner 3</span>
            <img id="preview3" class="preview-img" />
          </label>
        </div>
      </div>

      <h2 style="margin-bottom: 20px">Vagas Pendentes</h2>
      <div id="lista-pendentes"></div>

      <h2
        style="margin-top: 40px; border-top: 1px solid #444; padding-top: 20px"
      >
        Vagas Ativas (No Ar)
      </h2>
      <p style="color: #aaa; font-size: 0.9rem">
        Aqui est√£o as vagas que todo mundo est√° vendo. Cuidado ao excluir.
      </p>
      <div id="lista-aprovadas"></div>
    </div>

    <script>
      const API_URL = "";

      // --- LOGIN ---
      async function fazerLogin() {
        const senha = document.getElementById("campo-senha").value;
        const erroMsg = document.getElementById("erro-msg");
        try {
          const res = await fetch(`${API_URL}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ senha }),
          });
          const dados = await res.json();
          if (dados.sucesso) {
            document.getElementById("tela-login").style.display = "none";
            document.getElementById("painel-admin").style.display = "block";
            carregarPendentes();
            carregarAprovadas();
          } else {
            erroMsg.style.display = "block";
          }
        } catch (error) {
          alert("Erro de conex√£o");
        }
      }

      function sair() {
        location.reload();
      }

      // --- BANNERS ---
      function converterEEnviar(input, posicao) {
        const arquivo = input.files[0];
        if (!arquivo) return;

        const reader = new FileReader();
        reader.readAsDataURL(arquivo);

        reader.onload = async function () {
          const base64 = reader.result;

          const imgPreview = document.getElementById(`preview${posicao}`);
          imgPreview.src = base64;
          imgPreview.style.display = "block";

          try {
            const res = await fetch(`${API_URL}/admin/banners`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ imagem: base64, posicao: posicao }),
            });
            if (res.ok) {
              input.parentElement.style.borderColor = "#28a745";
            }
          } catch (erro) {
            console.error(erro);
          }
        };
      }

      // --- VAGAS PENDENTES ---
      async function carregarPendentes() {
        try {
          const res = await fetch(`${API_URL}/admin/pendentes`);
          const vagas = await res.json();
          const lista = document.getElementById("lista-pendentes");
          lista.innerHTML = "";
          if (vagas.length === 0) {
            lista.innerHTML =
              '<p style="color:#777">Nada para aprovar hoje.</p>';
            return;
          }

          vagas.forEach((vaga) => {
            const item = document.createElement("div");
            item.className = "vaga-pendente";
            item.innerHTML = `
                        <div class="vaga-info">
                            <h3>${vaga.titulo}</h3>
                            <p>${vaga.empresa} | ${
              vaga.categoria || "Geral"
            }</p>
                            <p>${vaga.salario}</p>
                        </div>
                        <div class="botoes">
                            <button class="btn-acao btn-aprovar" onclick="atualizarStatus(${
                              vaga.id
                            }, 1)">Aprovar</button>
                            <button class="btn-acao btn-reprovar" onclick="atualizarStatus(${
                              vaga.id
                            }, 2)">Reprovar</button>
                        </div>
                    `;
            lista.appendChild(item);
          });
        } catch (e) {
          console.error(e);
        }
      }

      // --- ATUALIZAR STATUS ---
      async function atualizarStatus(id, novoStatus) {
        await fetch(`${API_URL}/admin/vagas/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ status: novoStatus }),
        });
        carregarPendentes();
        carregarAprovadas();
      }

      // --- VAGAS APROVADAS (COM DATA!) ---
      async function carregarAprovadas() {
        try {
          const res = await fetch(`${API_URL}/admin/aprovadas`);
          const vagas = await res.json();
          const lista = document.getElementById("lista-aprovadas");
          lista.innerHTML = "";

          if (vagas.length === 0) {
            lista.innerHTML = '<p style="color:#777">Nenhuma vaga ativa.</p>';
            return;
          }

          vagas.forEach((vaga) => {
            // L√≥gica da data
            let dataTexto = "";
            if (vaga.data_postagem) {
              const dataObj = new Date(vaga.data_postagem);
              const diaMes = dataObj.toLocaleDateString("pt-BR", {
                day: "2-digit",
                month: "2-digit",
              });
              const hora = dataObj.toLocaleTimeString("pt-BR", {
                hour: "2-digit",
                minute: "2-digit",
              });
              dataTexto = `<span style="font-size: 0.85rem; color: #888; font-weight: normal; margin-left: 8px;">üìÖ ${diaMes} √†s ${hora}</span>`;
            }

            const item = document.createElement("div");
            item.className = "vaga-pendente";
            item.style.borderLeft = "5px solid #28a745";

            item.innerHTML = `
                    <div class="vaga-info">
                        <h3 style="display: flex; align-items: center; flex-wrap: wrap;">
                            ${vaga.titulo} 
                            ${dataTexto}
                        </h3>
                        <p>${vaga.empresa}</p>
                    </div>
                    <div class="botoes">
                        <button class="btn-acao btn-reprovar" onclick="excluirVaga(${vaga.id})">üóëÔ∏è Excluir</button>
                    </div>
                `;
            lista.appendChild(item);
          });
        } catch (error) {
          console.error("Erro ao carregar aprovadas:", error);
        }
      }

      // --- EXCLUIR VAGA ---
      async function excluirVaga(id) {
        if (confirm("Tem certeza que quer apagar essa vaga para sempre?")) {
          await fetch(`${API_URL}/admin/vagas/${id}`, { method: "DELETE" });
          carregarAprovadas();
        }
      }
    </script>
  </body>
</html>
